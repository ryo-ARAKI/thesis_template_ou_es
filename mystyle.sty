% +++++++++++++++++++++++++++++++++++++++++++
% 独自コマンドによるLaTeX設定の構築
% LaTeX，英語
% +++++++++++++++++++++++++++++++++++++++++++
%
% ===========================================
% フォント設定
% ===========================================
\usepackage{hyperref}  % 図・表・参考文献へのリンク
\usepackage[utf8]{inputenc} % utf-8を使うためのパッケージ
\usepackage{indentfirst}
\usepackage{times} % Use the times font
% \usepackage{palatino} % Uncomment to use the Palatino font
\usepackage{url}
%
% ===========================================
% 図・表関係
% ===========================================
\usepackage{here}
\usepackage{xcolor} % Specify colors by their 'svgnames', for a full list of all colors available see here: http://www.latextemplates.com/svgnames-colors
\usepackage{booktabs} % 表の横罫線
\usepackage{lscape}  % 表などを90度回転させる
\usepackage{longtable} % ページをまたぐ表の作成
\usepackage{subfig}
%
% ===========================================
% 数学記号
% ===========================================
\usepackage{bm, amsfonts, amsmath, amsthm, amssymb, ascmac}  % mathabx
\usepackage{siunitx}  %SI単位系を上手くやってくれる:\SI{数値}{単位}，\si{単位}
\usepackage{mathtools}
\usepackage{physics}
\usepackage{empheq}
% https://tex.stackexchange.com/a/147461
\def\onedot{$\mathsurround0pt\ldotp$}
\def\cddot{% two dots stacked vertically
  \mathbin{\vcenter{\baselineskip.67ex
    \hbox{\onedot}\hbox{\onedot}}%
  }}%
% mathematical environment
\usepackage{amsthm}
\theoremstyle{assumption}
\newtheorem*{assumption}{Assumption}
%
% ===========================================
% 参考文献のスタイルを独自定義
% ===========================================
\renewbibmacro{in:}{} % in: Some journal の "in:" を取る
\DeclareFieldFormat[article]{title}{#1}  % 論文タイトルにダブルクォートをつけない
\DeclareFieldFormat[inbook]{title}{\mkbibitalic{#1}}  % 書籍のタイトルを斜体
\DeclareSourcemap{%
  \maps[datatype=bibtex,overwrite=true]{
    % 雑誌名の短縮形．自分でリストを作る必要がある
    \map{
      \step[
        fieldsource=journal,
        match={Annual Review of Fluid Mechanics},
        replace={Annu. Rev. Fluid Mech.}]%
      \step[
        fieldsource=journal,
        match={Journal of Fluid Mechanics},
        replace={J. Fluid Mech.}]%
      \step[
        fieldsource=journal,
        match={Physical Review Letters},
        replace={Phys. Rev. Lett.}]%
      \step[
        fieldsource=journal,
        match={Physical Review E},
        replace={Phys. Rev. E}]%
      \step[
        fieldsource=journal,
        match={Physical Review Fluids},
        replace={Phys. Rev. Fluids}]%
      \step[
        fieldsource=journal,
        match={Physica D: Nonlinear Phenomena},
        replace={Physica D}]%
      \step[
        fieldsource=journal,
        match={New Journal of Physics},
        replace={New J. Phys.}]%
      \step[
        fieldsource=journal,
        match={European Journal of Mechanics, Fluids},
        replace={Eur. J. Mech. B Fluids}]%
      \step[
        fieldsource=journal,
        match={Fluid Dynamics Research},
        replace={Fluid Dyn. Res.}]%
      \step[
        fieldsource=journal,
        match={Journal of Computational Physics},
        replace={J. Comput. Phys.}]%
      \step[
        fieldsource=journal,
        match={Proceedings of the Royal Society A: Mathematical, Physical and Engineering Sciences},
        replace={Proc. R. Soc. A}]%
      \step[
        fieldsource=journal,
        match={Physics of Fluids},
        replace={Phys. Fluids}]%
      \step[
        fieldsource=journal,
        match={Computer Physics Communications},
        replace={Comput. Phys. Commun.}]%
      \step[
        fieldsource=journal,
        match={Flow, Turbulence and Combustion},
        replace={Flow Turbul. Combust.}]%
      \step[
        fieldsource=journal,
        match={International Journal of Heat and Fluid Flow},
        replace={Int. J Heat Fluid Fl.}]%
      \step[
        fieldsource=journal,
        match={Physics Letters A},
        replace={Phys. Lett. A}]%
      \step[
        fieldsource=journal,
        match={Theoretical and Computational Fluid Dynamics},
        replace={Theor. Comp. Fluid Dyn.}]%
      \step[
        fieldsource=journal,
        match={Progress of Theoretical Physics Supplement},
        replace={Prog. Theor. Phys. Supp.}]%
      \step[
        fieldsource=journal,
        match={Akademiia Nauk SSSR Doklady},
        replace={Dokl. Akad. Nauk SSSR}]%
      \step[
        fieldsource=journal,
        match={Journal of Statistical Physics},
        replace={J. Stat. Phys.}]%
      \step[fieldset=language, null]  % 言語を表示しない
      \step[fieldset=doi, null]  % doiを表示しない
    }
  }
}
%
% ===========================================
% itemizeの行間調整
% ===========================================
%
\let\oldenumerate\enumerate
\let\olditemize\itemize
\renewcommand{\itemize}{
  \olditemize
  \setlength{\itemsep}{2pt}    % 項目間
  \setlength{\parskip}{2pt}    % 段落間
  \setlength{\parsep}{0pt}
}
\renewcommand{\enumerate}{
  \oldenumerate
  \setlength{\itemsep}{2pt}    % 項目間
  \setlength{\parskip}{2pt}    % 段落間
  \setlength{\parsep}{0pt}
}
%
%
% +++++++++++++++++++++++++++++++++++++++++++
% 日本語環境の設定
% +++++++++++++++++++++++++++++++++++++++++++
%
\usepackage{otf}  % otfフォント
\usepackage{pxjahyper}  % しおりの文字化けを防止
%
% ===========================================
% 図，表，目次の設定
% ===========================================
\renewcommand{\figurename}{図}
\renewcommand{\tablename}{表}
\renewcommand{\contentsname}{目次}
%
% ===========================================
% biblatexのphysスタイルにおける日本語著者の識別子定義
% ===========================================
\newbibmacro*{finalnamedelim:{japanese}}{%
  \ifnumgreater{\value{liststop}}{2}{\finalandcomma}{}%
  \addspace\multinamedelim
}

\renewcommand*{\finalnamedelim}{%
  \iflistundef{language}
  {\ifnumgreater{\value{liststop}}{2}{\finalandcomma}{}%
  \addcomma\space}
  {\usebibmacro*{finalnamedelim:\strlist{language}}}
}

\newbibmacro*{name:given-family:{japanese}}[4]{%
  \usebibmacro{name:delim}{#1#2}\usebibmacro{name:hook}{#1#2}#1\bibnamedelimc#2}

\DeclareNameFormat{given-family}{%
  \iflistundef{language}{%
    \ifgiveninits
      {\usebibmacro{name:given-family}{\namepartfamily}{\namepartgiveni}{\namepartprefix}{\namepartsuffix}}
      {\usebibmacro{name:given-family}{\namepartfamily}{\namepartgiven}{\namepartprefix}{\namepartsuffix}}
  }
  {\usebibmacro*{name:given-family:\strlist{language}}{\namepartfamily}{\namepartgiven}{\namepartprefix}{\namepartsuffix}}
  \usebibmacro{name:andothers}
}
